<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Sınav Uygulaması</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #eef2f3; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .kart { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 15px 30px rgba(0,0,0,0.1); width: 500px; text-align: center; }

        /* Menü Stilleri */
        .konu-btn { display: block; width: 100%; padding: 15px; margin: 10px 0; background: #3498db; color: white; border: none; border-radius: 10px; font-size: 18px; cursor: pointer; transition: 0.2s; }
        .konu-btn:hover { background: #2980b9; transform: scale(1.02); }
        .gizli { display: none; }

        /* Soru Stilleri */
        .soru-kutusu { font-size: 22px; color: #2c3e50; margin: 20px 0 40px 0; font-weight: 600; }
        .secenekler-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .btn-sik { padding: 15px; border: 2px solid #e0e0e0; background-color: white; border-radius: 12px; cursor: pointer; font-size: 16px; transition: 0.2s; color: #555; font-weight: 500; }
        .btn-sik:hover { background-color: #f8f9fa; border-color: #bdc3c7; }
        .dogru { background-color: #d4edda !important; border-color: #28a745 !important; color: #155724 !important; }
        .yanlis { background-color: #f8d7da !important; border-color: #dc3545 !important; color: #721c24 !important; }
        .geri-don { margin-top: 20px; color: #7f8c8d; cursor: pointer; text-decoration: underline; font-size: 14px; }
    </style>
</head>
<body>

<div id="menu-ekrani" class="kart">
    <h2>Hangi Konudan Çözmek İstersin?</h2>
    <div id="konu-listesi">
        Yükleniyor...
    </div>
</div>

<div id="soru-ekrani" class="kart gizli">
    <div style="color: #3498db; font-weight: bold; font-size: 14px;">SORU</div>
    <div id="soru" class="soru-kutusu">Soru yükleniyor...</div>
    <div class="secenekler-grid">
        <button class="btn-sik" id="btnA" onclick="kontrolEt('A')">A</button>
        <button class="btn-sik" id="btnB" onclick="kontrolEt('B')">B</button>
        <button class="btn-sik" id="btnC" onclick="kontrolEt('C')">C</button>
        <button class="btn-sik" id="btnD" onclick="kontrolEt('D')">D</button>
    </div>
    <div id="sonuc-mesaji" style="margin-top:20px; height:20px;"></div>
    <div class="geri-don" onclick="menuyeDon()">← Konu Listesine Dön</div>
</div>

<script>
    let secilenKonuId = null;
    let aktifSoru = null;
    let tiklamaKilitli = false;

    // Sayfa açılınca Konuları Getir
    window.onload = function() {
        fetch('/api/sorular/konular')
            .then(res => res.json())
            .then(konular => {
                let html = "";
                konular.forEach(konu => {
                    html += `<button class="konu-btn" onclick="sinaviBaslat(${konu.id})">${konu.isim}</button>`;
                });
                document.getElementById('konu-listesi').innerHTML = html;
            });
    };

    function sinaviBaslat(id) {
        secilenKonuId = id;
        document.getElementById('menu-ekrani').classList.add('gizli');
        document.getElementById('soru-ekrani').classList.remove('gizli');
        soruGetir();
    }

    function menuyeDon() {
        document.getElementById('menu-ekrani').classList.remove('gizli');
        document.getElementById('soru-ekrani').classList.add('gizli');
    }

    function soruGetir() {
        tiklamaKilitli = false;
        document.getElementById('sonuc-mesaji').innerText = "";

        // Butonları temizle
        let butonlar = document.getElementsByClassName('btn-sik');
        for(let btn of butonlar) btn.className = 'btn-sik';

        // SEÇİLEN KONUYA GÖRE GETİR
        fetch(`/api/sorular/konu/${secilenKonuId}/siradaki`)
            .then(res => res.json())
            .then(data => {
                aktifSoru = data;
                document.getElementById('soru').innerText = data.soruMetni;
                document.getElementById('btnA').innerText = data.secenekA;
                document.getElementById('btnB').innerText = data.secenekB;
                document.getElementById('btnC').innerText = data.secenekC;
                document.getElementById('btnD').innerText = data.secenekD;
            });
    }

    function kontrolEt(secilenSikHarfi) {
        if(tiklamaKilitli) return;
        tiklamaKilitli = true;
        let secilenButon = document.getElementById('btn' + secilenSikHarfi);
        let dogruMu = (secilenButon.innerText === aktifSoru.dogruCevap);

        if(dogruMu) {
            secilenButon.classList.add('dogru');
            document.getElementById('sonuc-mesaji').innerText = "Tebrikler!";
        } else {
            secilenButon.classList.add('yanlis');
            document.getElementById('sonuc-mesaji').innerText = "Doğrusu: " + aktifSoru.dogruCevap;
        }

        setTimeout(soruGetir, 1500);
    }
</script>
</body>
</html>